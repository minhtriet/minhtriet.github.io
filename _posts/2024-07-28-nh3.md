---
layout: post
title:  Optimizing the Geometry of the Haber-Bosch Process Using Quantum Computing
excerpt: Can quantum computer do DFT with the help of Machine learning?
---

**TLDR**: We contribute an approach to simulate chemistry reaction with (1) catalyst and (2) endothermicity.

# Introduction
The Haber-Bosch process enables the large-scale synthesis of amonia . Its reaction is

$$\begin{align}\text{N}_2 + 3\text{H}_2 \overset{Fe}{\longrightarrow} 2\text{NH}_3 \end{align}$$

This process, however, is energy-intensive and relies catalysts. Understand the reaction pathway with catalyst hopes to gain insights into the process, thus enhance its efficiency. [1] has simulated the reaction using VASP using Fe211 as a catalyst and shows in Fig. 1.

<figure>
  <img src="https://github.com/user-attachments/assets/5c2dbc1b-c124-4041-9f75-2d0e40e0a42d">
  <figcaption>Fig 1. Reaction pathway of the Harber-Bosch process in [1] </figcaption>
</figure>

VASP is computationally expensive. This post explores how we can use Pennylane to execute the first steps with limited computer resource. Concretely, we replicate the first three steps of [1] in Figure 2, which are the most complex reactions in the whole pathway. It is computationally cheaper than the method used in [1]

# Method
There are two methods in use, gradient descent and Bayesian optimization. The former method has good coverage in these [Pennylane](https://pennylane.ai/qml/demos/tutorial_chemical_reactions/) [demoes](https://pennylane.ai/qml/demos/tutorial_mol_geo_opt/) in a 1D setup. Here we focus on the latter in a 3D setup.

## Motivation
To define a 3D affine transformation for a molecule, we need to define translation parameter $$t_x, t_y, t_z$$ and rotational parameter $$\theta_x,\theta_y,\theta_z$$. For gradient descent, we need to know $$t_\bullet \pm \Delta_t$$ and $$\theta_\bullet \pm \Delta_\theta$$. For each ingredient we needs to calculate $6 \times 2$ Hamiltonians before each coordinate update, which is expensive.

BO, being a gradient-less method, does not have these requirements. From some initial samplings, we fit a Guassian around these data points. Then we use the acquision function $$\alpha$$ to optain new positions and pass then to the Hamilton, keeping log of them and estimate the posterior value of the ground state enerygy given the coordinates. A nice point of GP is that confidence interval

![plot_gp_regression_001](https://github.com/user-attachments/assets/ace60973-79ec-4274-b994-c0e68b8645e9)
 $$\alpha$$ function we are using is called Expected Improvement.


When going from a joint distribution to a conditional distribution, we refer readers to [3] 

## Simplification
To facilitate the calculation with our limited computer resource we made the following simplification
1. We use $$STO-3G$$, a very simple orbital basis.
2. The substrate is simplied in comparison to [1]. To speed up the Hamiltonian calculation, here we used a minimal substrate of Fe-211 as the substitute.
<div class="row">
	<div class="column">
		<figure>
	<img alt="image" style="margin:0 20%" width="200px" src="https://github.com/user-attachments/assets/c981aea2-1fb2-4cad-95b8-0ba84b8cee11">
	
		<figcaption>The Fe211 catalyst substrate used in [1] </figcaption>
		</figure>
  	</div>
	<div class="column">
		<figure>
	<img width="200px" style="margin:0 20%" src="https://github.com/user-attachments/assets/aa6a75ec-c8f5-406b-82df-9de6bb4838a6">
 	<figcaption>The simplified catalyst in our work </figcaption>
		</figure>
	</div>
</div>

## Process
1. Varies the coordinates of the reactant: The transition in $$x,y,z$$ axis and rotation angle around its center. 
2. Construct the Hamiltonian
3. Measure and Optimize: Measure the expectation value of the Hamiltonian using the quantum circuit and optimize the parameters using a classical optimizer to minimize this value.


We experiment with two variational methods: Bayesian optimization (BO) and Gradient descent. Bayesian optimization is derivative-free and can overcome some draw back of gradient descent in cases that we would detail in later parts.

# Visualization
In the below visualization, we color coded the atoms as 
<span class="boxed fe">
      $$Fe$$
</span>
<span class="boxed n">
      $$N$$
</span>, and
<span class="boxed h">
      $$H$$
</span>. Please open the GIFs / videos in new tab for a full resolution version.

## Step 1
We use gradient descent method to optimze the coordinates of the reactants. The result is as follow.
<div class="row">
	<div class="column">
		<img alt="image" src="https://github.com/user-attachments/assets/0463d31a-b969-42af-9cef-c7c4c7cbbb72">
	</div>
	<div class="column">
		<img alt="image" src="https://github.com/user-attachments/assets/3213af70-d246-43c7-859d-5c12cb607d5e">
	</div>
	<div class="column">
		<img src="https://github.com/user-attachments/assets/ad7863f8-26a2-4ebd-93fa-83bdc119fc14">
  	</div>
</div>
Even with the same learning rate, the speed of the reactants slow down greatly in compared to the beginning. Therefore, we conclude that in this step, the learning converged.

## Step 2
Following the success from the previous step, we apply the same method for this step.
<div class="row">
<div class="column">
 	<img alt="image" src="https://github.com/user-attachments/assets/e02f4911-6a03-4fde-82bf-d81f0250f94f">
 </div>
 <div class="column">
 	<img alt="image" src="https://github.com/user-attachments/assets/523ecb70-6cf6-4c20-a077-0f957f0b255e">
 </div>
</div>
Apparently we are stuck at a local minima, gradient descent would have a hard time escaping this. It is because of the endothermicity of this reaction ($$0.98$$ below the arrow). On the other hand, the BO can overcome that minima.

<div class="row">
 <div class="column">
        <img alt="image" src="https://github.com/user-attachments/assets/513c5f1e-ec65-4a97-b6d7-403902fb096a">
</div>
<div class="column">
        <img src="https://github.com/user-attachments/assets/ede2698a-2db0-41d1-a3c5-27c8bb818aa9">
</div>
</div>
We figured out that most of the $$H$$ went too far away from the catalyst substrate, due to our initial set up of the search margin, which is $$1 nm$$ bigger than the catalyst substrate. Here we filter only what went inside the substrate.

 <div class="row">
<div class="column">
 ﻿<img alt="image" src="https://github.com/user-attachments/assets/3673603c-4900-4453-84b8-e9cfd8ece620">
 </div>
  <div class="column">
 ﻿<img src="https://github.com/user-attachments/assets/2017c7e1-885e-4265-a1cf-1852f65c67a1">
</div>
</div>

It is evident that the search boundary condition is of utmost important. After the above result, we modify the search space as below.
<figure>
   ﻿<img src="https://github.com/user-attachments/assets/0fd1987e-55d7-40f3-ac2d-6231d561a95d">
  <figcaption>The size of the search boundary in comparison with a $Fe$ atom</figcaption>
</figure>

Here is the optimization after setting the search boundary
 <div class="row">
<div class="column">
 <video controls autoplay mute loop>
 <source src="https://github.com/user-attachments/assets/58da4eaa-548d-4c2b-8c57-eb7368073973" type="video/mp4"/>
</video>
</div>
<div class="column">
 <video controls autoplay mute loop>
 <source src="https://github.com/user-attachments/assets/000ac2a4-21fe-4055-b48f-da7da6998d4f" type="video/mp4"/>
</video>
 </div>


On frame 12th and 13th, we have what we were looking for. However, the config that creates $$NH_3$$ still has higher ground state energy in comparison with the config where $$H$$ atoms just float away. It can either means that we discover the reaction rate of this intermediate steps, or we the problem needs to be run in more complex molecular orbital basis and/or more complex catalyst substrate.

Note that there are times that the BO choose to sample two very close points, it is because of the exploitation

## Conclusion
This serve as a proof that an alternative method than the DFT can be applied in chemistry simulation. Some of the limitations are
1. Due to the lack of computational resource we have to reduce the catalyst platform, number of active orbitals and electrions
2. The number of active electrons and oribtals. These parameters are visible to`chem_config.yaml`
3. Setting the bound of the BO is critical to a good learning result. Even when we receive the minima, it would be interesting to see if gradient descent can further finetune the result.

The parameters of free electrons and free orbitals are crucial here. A full configuration interaction can take up to TBs of RAM to calculate


# References 
[1] Reaction mechanism and kinetics for ammonia synthesis on the Fe(211) reconstructed surface.  Jon Fuller, Alessandro Fortunelli, William A. Goddard III and  Qi An

[2] Reiher Markus, Nathan Wiebe, Krysta M. Svore, Dave Wecker and Matthias Troyer. Elucidating reaction mechanisms on quantum computers. Proceedings of the National Academy of Sciences 2017

[3] Kevin Patrick Murphy. Machine Learning: a Probabilistic Perspective. MIT Press, 2012

# SI

Coputational resource:
- Gradient descent: 32 CPU, 256 GB RAM, 50h run
- BO: 8 CPU, 64 GB RAM, 60h run

---

This blog post provides a comprehensive overview of using quantum computing to optimize the geometry of the Haber-Bosch process with an Fe 211 catalyst. By integrating quantum computing fundamentals, detailed technical explanations, and practical implications, it aims to inform and inspire both quantum software engineers and chemistry experts.
